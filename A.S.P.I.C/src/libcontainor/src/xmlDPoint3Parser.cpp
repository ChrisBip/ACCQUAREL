/* 
* The containor library of A.S.P.I.C. 
 * Written and directed by François Lodier francois.lodier@gmail.com.
 *
 * Copyright (C) 2005  François Lodier
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 */
#include "xmlDPoint3Parser.h"

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Constructeur.
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
xmlDPoint3Parser::xmlDPoint3Parser(void)
: xmlParser()
{
	resetTagNames();
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Constructeur.
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
xmlDPoint3Parser::xmlDPoint3Parser(DOMElement * DOMPointElement)
: xmlParser(DOMPointElement)
{
	resetTagNames();
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Destructeur.
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
xmlDPoint3Parser::~xmlDPoint3Parser(void)
{
	;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder à la valeur du point.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
dpoint<3> xmlDPoint3Parser::getDPoint3(const DOMElement * rootElement) const
{
	dpoint<3> value;
	
	DOMNode * xNode;
	DOMNode * yNode;
	DOMNode * zNode;
	DOMElement * positionElement;

	/////////////////////////////////////////////////////////////////////////
	// On récupère l'élément qui correspond à la position.
	//////////////////////////////////////////////////////////////////////////
	positionElement = (DOMElement *)getElementByTagName(rootElement , getDPoint3TagName());

	if(positionElement == NULL) {
		cerr << "Error : in dpoint<3> xmlDPoint3Parser::getDPoint3(DOMElement * rootElement) const" << endl;
		cerr << "Error : no " << getDPoint3TagName() << " tag name was found in the document" << endl;
		cerr << "Error : aborting." << endl;
	}
	
	/////////////////////////////////////////////////////////////////////////
	// On récupère le noeud en x.
	//
	// - Lorsque ce noeud n'existe pas on arrete l'execution du 
	// programme.
	/////////////////////////////////////////////////////////////////////////
	xNode = getElementByTagName(positionElement , getXTagName());

	if(xNode == NULL) {
		cerr << "Error : in dpoint<3> xmlDPoint3Parser::getDPoint3(void) const" << endl;
		cerr << "Error : no tag was found with first coordonate for position." << endl;
		cerr << "Error : unable to read position. Aborting." << endl;
		exit(1);
	}

	value[0] = getNodeDoubleValue(xNode);
	
	/////////////////////////////////////////////////////////////////////////
	// On récupère le noeud en y.
	//
	// - Lorsque ce noeud n'existe pas on arrete l'execution du 
	// programme.
	/////////////////////////////////////////////////////////////////////////
	yNode = getElementByTagName(positionElement , getYTagName());

	if(yNode == NULL) {
		cerr << "Error : in dpoint<3> xmlDPoint3Parser::getDPoint3(void) const" << endl;
		cerr << "Error : no tag was found with second coordonate for position." << endl;
		cerr << "Error : unable to read position. Aborting." << endl;
		exit(1);
	}
	
	value[1] = getNodeDoubleValue(yNode);

	/////////////////////////////////////////////////////////////////////////
	// On récupère le noeud en z.
	//
	// - Lorsque ce noeud n'existe pas on arrete l'execution du 
	// programme.
	/////////////////////////////////////////////////////////////////////////
	zNode = getElementByTagName(positionElement , getZTagName());

	if(zNode == NULL) {
		cerr << "Error : in dpoint<3> xmlDPoint3Parser::getDPoint3(void) const" << endl;
		cerr << "Error : no tag was found with third coordonate for position." << endl;
		cerr << "Error : unable to read position. Aborting." << endl;
		exit(1);
	}
	
	value[2] = getNodeDoubleValue(zNode);

	////////////////////////////////////////////////////////////////////////////
	// On renvoie la position qui a été lue.
	////////////////////////////////////////////////////////////////////////////
	return value;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder à la valeur du point.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
dpoint<3> xmlDPoint3Parser::getDPoint3(void) const
{
	return getDPoint3(getRootElement());
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag racine.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
const string & xmlDPoint3Parser::getDPoint3TagName(void) const
{
	return DPoint3TagName;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag qui balise la première coordonnée.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
const string & xmlDPoint3Parser::getXTagName(void) const
{
	return XTagName;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag qui balise la seconde coordonnée.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
const string & xmlDPoint3Parser::getYTagName(void) const
{
	return YTagName;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag qui balise la troisième coordonnée.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
const string & xmlDPoint3Parser::getZTagName(void) const
{
	return ZTagName;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag racine.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
void xmlDPoint3Parser::setDPoint3TagName(const string & dPoint3TagName)
{
	DPoint3TagName = dPoint3TagName;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag qui balise la troisième coordonnée.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
void xmlDPoint3Parser::setXTagName(const string & xTagName)
{
	XTagName = xTagName;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag qui balise la troisième coordonnée.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
void xmlDPoint3Parser::setYTagName(const string & yTagName)
{
	YTagName = yTagName;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour accéder au nom du tag qui balise la troisième coordonnée.
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
void xmlDPoint3Parser::setZTagName(const string & zTagName)
{
	ZTagName = zTagName;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Méthode pour remettre les tags à leur valeur initiale.
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
void xmlDPoint3Parser::resetTagNames(void) 
{
	DPoint3TagName = "Position";
	XTagName = "x";
	YTagName = "y";
	ZTagName = "z";
}
